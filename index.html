<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8"></meta>
  <title>Snake</title>
</head>

<body>
  <div id="screen"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/two.js/0.4.0/two.js"></script>
  <script>
    var main = function(){
    var twoLibraryParams = {
      width: 800,
      height: 600
    };

    var boardSize = {
      width: 40,
      height: 30
    };
    
    var fieldColors = {
      "empty": "grey",
      "snake": "green",
      "food": "yellow"
    };
    
    var directions = {
      "left": [-1, 0],
      "right": [1, 0],
      "up": [0, -1],
      "down": [0, 1]
    };
    
    var snake = [[0,0]];
    
    
    var maxLength = 8;

    var two = new Two(twoLibraryParams);

    var snakeGroup = two.makeGroup();
    
    var currentDirection = "right";

    var growSnake = function(eventBuffer) {
      for(var i = 0; i < eventBuffer.length; i = i + 1) {
        if (eventBuffer[i] in directions){
          currentDirection = eventBuffer.pop(i);
          break;
        }
      }
      var newX = ((snake[snake.length - 1][0] + directions[currentDirection][0])) % boardSize.width;
      var newY = (snake[snake.length - 1][1] + directions[currentDirection][1]) % boardSize.height;
      var newPosition = [newX, newY];
      snake.push(newPosition);
      if(snake.length > maxLength) {
        snake = snake.slice(snake.length - maxLength, snake.length);
      }
    };

    
    var makeRectangle = function(topLeftX, topLeftY, width, height) {
      var right = topLeftX + width;
      var bottom = topLeftY + height;
      return two.makePolygon(topLeftX, topLeftY,
                             right, topLeftY,
                             right, bottom,
                             topLeftX, bottom);
    };
    
    var makeTile = function(xy) {
      var tileWidth = twoLibraryParams.width/boardSize.width;
      var tileHeight = twoLibraryParams.height/boardSize.height;
      return makeRectangle(xy[0]*tileWidth, xy[1]*tileHeight, tileWidth, tileHeight);
    };
    
    var init = function() {
      var screen = makeRectangle(0, 0,
                                 twoLibraryParams.width, twoLibraryParams.height);
      screen.noStroke();
      screen.fill = "grey";
    };


    var showSnake = function() {
      snakeGroup.remove(snakeGroup.children);
      snake.forEach(function(coords){
        var snakeSegment = makeTile(coords);
        snakeSegment.addTo(snakeGroup);
        snakeSegment.fill = fieldColors["snake"];
      });
    };
      
    window.onload = function() {
      var screen = document.getElementById("screen");
      two.appendTo(screen);
      //init();
      two.bind('update', function(frameCount) {
        growSnake([]);
        showSnake();
      }).play();
      
      /*growSnake([]);
      growSnake([]);
      growSnake([]);
      showSnake();
      two.update();
      showSnake();
      two.update();*/
    };
    };
    main();
  </script>
</body>

</html>
